---
title: "calucalte the variance explained"
output: NULL
author: "Jinliang Yang"
date: 10-20-2019
---

```{r setup}
# , include=TRUE, warning=FALSE, echo=TRUE, error=FALSE
knitr::opts_knit$set(root.dir=normalizePath('../../'))
knitr::opts_chunk$set(warning=FALSE, message=FALSE, error=FALSE, echo=TRUE)
```

# Read in the dataset

```{r}
# meta data
d <- read.csv("data/sample_data.csv")

# ASV table
asv <- read.csv("data/ASV_table.csv")
```

In total, we have 575 samples, each of them with `dim(asv)` ASV.


# Model it

```{r}
# install.packages("lme4")
library("lme4")

fit1 <- lmer(data=d, Shannon ~ (1|Species) + (1|Nitrogen) + (1|Rotation) + (1|Year) + (1|Block) + (1|Rep))


df <- as.data.frame(VarCorr(fit1))
```

First of all, year explained 10% of the variance, which is the only significant explanatary variable.

```{r}
fit2 <- lmer(data=d, Shannon ~ Year + (1|Species) + (1|Nitrogen) + (1|Rotation) +  (1|Block) + (1|Rep))

fit2 <- lmer(data=d, Shannon ~ Year + Species + (1|Nitrogen) + (1|Rotation) +  (1|Block) + (1|Rep))

```

