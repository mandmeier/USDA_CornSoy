---
title: "calucalte the variance explained"
output: NULL
author: "Jinliang Yang"
date: 10-20-2019
---

```{r setup}
# , include=TRUE, warning=FALSE, echo=TRUE, error=FALSE
knitr::opts_knit$set(root.dir=normalizePath('../../'))
knitr::opts_chunk$set(warning=FALSE, message=FALSE, error=FALSE, echo=TRUE)
```

# Read in the dataset

```{r}
# meta data
d <- read.csv("data/sample_data.csv")

# ASV table
asv <- read.csv("data/ASV_table.csv")
```

In total, we have 575 samples, each of them with `dim(asv)` ASV.




# Simple visulation

```{r}
library(ggplot2)
# Interleaved histograms
ggplot(d, aes(x=Shannon, color=Fraction)) +
  geom_histogram(fill="white", position="dodge")+
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9")) +
  theme(legend.position="top")
```
```{r}
# Interleaved histograms
ggplot(d, aes(x=log(d$ASV_counts), color=Fraction)) +
  geom_histogram(fill="white", position="dodge")+
  scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9")) +
  theme(legend.position="top")
```



```{r}
library("lme4")


dim(d)
hist(d$Shannon)
hist(log(d$ASV_counts))

## Model One:
fit <- lmer(data=d, Shannon ~ (1|Year) + (1|Species) + (1|Rotation) + (1|Nitrogen) + (1|Fraction) + (1|Block) + (1|Rep))
df <- as.data.frame(VarCorr(fit))
df$p <- df$vcov/sum(df$vcov)*100


## Model Two:
fit <- lmer(data=d, Shannon ~ (1|Year) + (1|Species) + (1|Rotation) + (1|Nitrogen) + (1|Fraction) + (1|Block) + (1|Rep))
df <- as.data.frame(VarCorr(fit))
df$p <- df$vcov/sum(df$vcov)*100



```

